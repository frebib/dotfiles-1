#!/usr/bin/env bash

if xrandr | grep "\<connected\>" | grep $SECOND_DISPLAY; then
  SINGLE_DISPLAY="false"
else
  SINGLE_DISPLAY="true"
fi

bspc config border_width 2
bspc config top_padding $PANEL_HEIGHT
bspc config split_ratio 0.50
bspc config single_monocle true
bspc config gapless_monocle true
bspc config borderless_monocle $SINGLE_DISPLAY
bspc config remove_disabled_monitors true
bspc config remove_unplugged_monitors true
bspc config normal_border_color '#333333'
bspc config focused_border_color '#F9D3A5'
bspc config initial_polarity second_child
bspc config window_gap 0

bspc config click_to_focus button1
bspc config pointer_modifier control
bspc config pointer_action1 resize_corner
bspc config pointer_action2 resize_side
bspc config pointer_action3 move

# Setup workspaces
bspc monitor "$MAIN_DISPLAY" -d one two three four five six seven eight dmp

# Check if the second monitor is connected
if $SINGLE_DISPLAY; then
  bspc monitor "$SECOND_DISPLAY" -d None
else
  echo Setting up second display
  bspc monitor "$SECOND_DISPLAY" -d uno dos
  # Check if the monitors are in the wrong order
  if ! bspc query --monitors --names | head -1 | grep $MAIN_DISPLAY; then
    bspc monitor "$MAIN_DISPLAY" --swap "$SECOND_DISPLAY"
  fi
fi

# Rule for quake-like terminal
bspc rule --add *:QuakeTerminal state=floating sticky=on border=on

# Set background
feh --bg-fill $BACKGROUND_IMAGE
# Start bar
kill $(pgrep -f panel.py) ; $PANEL_PATH/panel.py &
# Start compton
killall compton ; compton &
# Start sxhkd
killall sxhkd ; sxhkd &
